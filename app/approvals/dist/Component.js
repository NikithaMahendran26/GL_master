sap.ui.define(["sap/ui/core/UIComponent","sap/ui/model/json/JSONModel"],function(e,t){"use strict";return e.extend("approvals.Component",{metadata:{manifest:"json"},init:function(){e.prototype.init.apply(this,arguments);this.setModel(new t([]),"initiatorModel");this.setModel(new t([]),"approverModel");this.setModel(new t([]),"commentModel");this.setModel(new t({editable:false,title:"",closeText:"Close"}),"ui");this._initFromInbox()},createContent:function(){this._mainView=sap.ui.view({id:"glTaskView",viewName:"approvals.view.approvals",type:"XML"});this._mainView.setModel(this.getModel("ui"),"ui");return this._mainView},_initFromInbox:function(){const e=this.getComponentData()?.startupParameters;if(!e?.taskModel){console.error("App not launched from Inbox");return}this.setModel(e.taskModel,"task");const t=e.taskModel.getData();console.log("Inbox Task Data",t);const o=t.TaskTitle||"";const s=o.split(" ")[0];if(!s){console.error("Request ID not found in task title",o);return}this._loadGL(s)},_loadGL:function(e){const o=this.getModel("mainServiceModel")||this.getModel();if(!o){console.error("OData model not found");return}const s=`/GlMasterRequests(requestId='${e}')`;o.read(s,{urlParameters:{$expand:"glMasterItems"},success:function(e){console.log("GL OData response",e);const o=new t({items:e.glMasterItems?.results||[]});if(this._mainView){this._mainView.setModel(o,"glModel")}else{this.setModel(o,"glModel")}}.bind(this),error:function(e){console.error("Failed to load GL request",e)}})},addApproverComment:function(e,t){const o=this.getModel("approverModel").getData();o.push({Text:e,UserName:t,Date:(new Date).toLocaleString()});this.getModel("approverModel").setData(o);this._mergeComments()},_mergeComments:function(){const e=[...this.getModel("initiatorModel").getData(),...this.getModel("approverModel").getData()];e.sort((e,t)=>new Date(t.Date)-new Date(e.Date));this.getModel("commentModel").setData(e)}})});
//# sourceMappingURL=Component.js.map