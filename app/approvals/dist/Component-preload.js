//@ui5-bundle approvals/Component-preload.js
sap.ui.predefine("approvals/Component", ["sap/ui/core/UIComponent","sap/ui/model/json/JSONModel"],function(e,t){"use strict";return e.extend("approvals.Component",{metadata:{manifest:"json"},init:function(){e.prototype.init.apply(this,arguments);this.setModel(new t([]),"initiatorModel");this.setModel(new t([]),"approverModel");this.setModel(new t([]),"commentModel");this.setModel(new t({editable:false,title:"",closeText:"Close"}),"ui");this._setupInboxActions();this._initFromInbox()},_setupInboxActions:function(){const e=this.getComponentData()?.startupParameters;if(!e?.inboxAPI){console.warn("Inbox API not available");return}const t=e.inboxAPI;t.addAction({action:"APPROVE",label:"Approve",type:"accept"},()=>this._onApprove());t.addAction({action:"REJECT",label:"Reject",type:"reject"},()=>this._onReject())},createContent:function(){this._mainView=sap.ui.view({id:"glTaskView",viewName:"approvals.view.approvals",type:"XML"});this._mainView.setModel(this.getModel("ui"),"ui");this._mainView.setModel(this.getModel("commentModel"),"commentModel");this._mainView.setModel(this.getModel("initiatorModel"),"initiatorModel");this._mainView.setModel(this.getModel("approverModel"),"approverModel");return this._mainView},_initFromInbox:function(){const e=this.getComponentData()?.startupParameters;if(!e?.taskModel){console.error("App not launched from Inbox");return}this.setModel(e.taskModel,"task");const t=e.taskModel.getData();console.log("Inbox Task Data",t);const o=t.TaskTitle||"";const n=o.split(" ")[0];if(!n){console.error("Request ID not found in task title",o);return}this._loadGL(n)},_loadGL:function(e){const o=this.getModel("mainServiceModel")||this.getModel();if(!o){console.error("OData model not found");return}const n=`/GlMasterRequests(requestId='${e}')`;o.read(n,{urlParameters:{$expand:"glMasterItems"},success:function(e){console.log("GL OData response",e);const o=new t({items:e.glMasterItems?.results||[]});if(this._mainView){this._mainView.setModel(o,"glModel")}else{this.setModel(o,"glModel")}}.bind(this),error:function(e){console.error("Failed to load GL request",e)}})},addApproverComment:function(e,t){const o=this.getModel("approverModel").getData();o.push({Text:e,UserName:t,Date:(new Date).toLocaleString()});this.getModel("approverModel").setData(o);this._mergeComments()},_mergeComments:function(){const e=[...this.getModel("initiatorModel").getData(),...this.getModel("approverModel").getData()];e.sort((e,t)=>new Date(t.Date)-new Date(e.Date));this.getModel("commentModel").setData(e)},_onApprove:async function(){try{const e=await this._postGLToSAP();if(!e.success){sap.m.MessageBox.error("SAP Error:\n"+e.error);return}sap.m.MessageToast.show("GL Account approved & created");this._completeWorkflowTask()}catch(e){sap.m.MessageBox.error(e.message||"Approval failed")}},_postGLToSAP:function(){return new Promise(e=>{const t=this.getModel("CreateGLServiceModel");if(!t){e({success:false,error:"CreateGLServiceModel not found"});return}const o=this._mainView?.getModel("glModel")||this.getModel("glModel");if(!o){e({success:false,error:"GL data model not available"});return}const n=o.getData();const s=n?.items?.[0];if(!s){e({success:false,error:"GL request data is empty"});return}const a={GLACCNO:s.GLAccount||"",CHACCTS:s.ChartOfAccounts||"",ACCGRP:s.AccountGroup||"",GLACCTYPE:s.GLAccountType||"",LANGUAGE:"EN",SHTEXT:s.ShortText||"",LGTEXT:s.GLAccountLongText||"",COMPCODE:s.CompanyCode||"",CURRENCY:s.AccountCurrency||"",FELDSTGRP:s.FieldStatusGroup||"",HOUSEBK:s.HouseBank||"",BALINLCLCURR:s.LocalCurrencyOnly===true?"X":"",TAXCATEGORY:s.TaxCategory||"",RECONACCT:s.ReconciliationAccount||"",SORTKEY:s.SortKey||"",PLACCT:s.PlanningAccount||"",BALSHEETINDI:s.BalanceSheetIndicator||"",TRADEPARTNO:s.TradingPartner||"",EXRTDIFFKEY:s.ExchangeRateDiffKey||"",ALTACCTNO:s.AlternateAccount||"",INFKEY:s.InflationKey||"",PSTWOTAX:s.PostWithoutTax||"",ACTMNGEXT:s.OpenItemManagement===true?"X":"",TOLGRP:s.ToleranceGroup||"",XLGCLR:s.LineItemDisplay||"",XOPVW:s.OpenItemView||"",AUTHGRP:s.AuthorizationGroup||"",CLERKABBV:s.ClerkAbbreviation||"",RECID:s.RecId||"",SUPAUTOPOST:s.SupplementAutoPost||"",RECONACTINPUT:s.ReconAccountInput||"",PLANLEVEL:s.PlanningLevel||"",CASHFLOWREL:s.CashFlowRelevant||"",COMMITITEM:s.CommitmentItem||"",ACCTID:s.AccountId||"",INTINDICATOR:s.InterestIndicator||"",INTCALCFREQ:s.InterestCalcFrequency||"",ZINDT:s.InterestKeyDate||"",DATLZ:s.LastInterestCalcDate||"",POSTAUTO:s.AutoPost||""};t.create("/ETY_CREATEGLSet",a,{success:function(){e({success:true})},error:function(t){let o="Unknown SAP error";try{const e=JSON.parse(t.responseText);o=e?.error?.message?.value||e?.error?.innererror?.errordetails?.[0]?.message||o}catch(e){}e({success:false,error:o})}})})},_fetchWorkflowToken:async function(){const e=await fetch("/bpmworkflowruntime/v1/xsrf-token",{method:"GET",headers:{"X-CSRF-Token":"Fetch"},credentials:"include"});return e.headers.get("X-CSRF-Token")},_completeWorkflowTask:async function(){const e=this._getWorkflowBaseURL();const t=this.getModel("task").getData().InstanceID;const o=await this._fetchWorkflowToken();const n=await fetch(`${e}/task-instances/${t}`,{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-Token":o},credentials:"include",body:JSON.stringify({status:"COMPLETED"})});if(!n.ok){throw new Error("Workflow task completion failed")}},_getWorkflowBaseURL:function(){return"/bpmworkflowruntime/v1"}})});
sap.ui.predefine("approvals/controller/App.controller", ["sap/ui/core/mvc/Controller"],e=>{"use strict";return e.extend("approvals.controller.App",{onInit(){}})});
sap.ui.predefine("approvals/controller/approvals.controller", ["sap/ui/core/mvc/Controller","sap/ui/core/Fragment","sap/ui/model/json/JSONModel","sap/m/MessageToast"],function(e,t,o,s){"use strict";return e.extend("approvals.controller.approvals",{onInit:function(){var e=new o;var t=[];e.setData(t)},onViewApproval:async function(){if(!this._selectedGL){s.show("Please select a GL record");return}this.getView().setModel(new o(this._selectedGL),"GLRequestModel");const e=this.getView().getModel("ui");e.setProperty("/editable",false);e.setProperty("/title","View GL Account");e.setProperty("/closeText","Close");if(!this._glDialog){this._glDialog=await t.load({id:this.getView().getId(),name:"approvals.fragments.gldata",controller:this});this.getView().addDependent(this._glDialog)}this._glDialog.open()},_openDialog:async function(e,o){const s=this.getView().getModel("ui");s.setProperty("/editable",e);s.setProperty("/title",o);s.setProperty("/closeText",e?"Cancel":"Close");if(!this._glDialog){this._glDialog=await t.load({id:this.getView().getId(),name:"approvals.fragments.gldata",controller:this})}this._glDialog.open()},onSelectionChange:function(e){const t=e.getParameter("listItem");const o=!!t;this.byId("viewbtn").setEnabled(o);this.byId("changeLogBtn").setEnabled(o);if(o){this._selectedGL=t.getBindingContext("glModel").getObject()}},onCommentPost:function(e){const t=e.getParameter("value");if(!t)return;const o=sap.ushell?.Container?.getUser?.().getEmail()||"approver@dummy";this.getOwnerComponent().addApproverComment(t,o);e.getSource().setValue("")},onCloseGL:function(){this._glDialog.close()}})});
sap.ui.predefine("approvals/model/models", ["sap/ui/model/json/JSONModel","sap/ui/Device"],function(e,n){"use strict";return{createDeviceModel:function(){var i=new e(n);i.setDefaultBindingMode("OneWay");return i}}});
sap.ui.require.preload({
	"approvals/fragments/gldata.fragment.xml":'<core:FragmentDefinition\n    xmlns="sap.m"\n    xmlns:core="sap.ui.core"\n    xmlns:f="sap.ui.layout.form"><Dialog\n        id="dlgGLAccount"\n        title="{ui>/title}"\n        contentWidth="100%"\n        contentHeight="100%"\n        resizable="true"\n        draggable="true"><content><IconTabBar class="sapUiResponsiveContentPadding"><items><IconTabFilter text="Initial" icon="sap-icon://add-document"><f:SimpleForm\n                            editable="true"\n                            layout="ResponsiveGridLayout"\n                            labelSpanXL="4"\n                            labelSpanL="3"\n                            labelSpanM="12"\n                            labelSpanS="12"\n                            adjustLabelSpan="false"\n                            emptySpanXL="0"\n                            emptySpanL="0"\n                            emptySpanM="0"\n                            emptySpanS="0"\n                            columnsXL="2"\n                            columnsL="2"\n                            columnsM="1"\n                            singleContainerFullSize="false"><f:content><Label text="GL Account"/><Input value="{GLRequestModel>/GLAccount}"\n                                       editable="{ui>/editable}"/><Label text="Company Code"/><Input value="{GLRequestModel>/CompanyCode}"\n                                       editable="{ui>/editable}"/></f:content></f:SimpleForm></IconTabFilter><IconTabFilter text="Type / Description" icon="sap-icon://edit"><f:SimpleForm\n                            editable="true"\n                            layout="ResponsiveGridLayout"\n                            labelSpanXL="4"\n                            labelSpanL="3"\n                            labelSpanM="12"\n                            labelSpanS="12"\n                            adjustLabelSpan="false"\n                            emptySpanXL="0"\n                            emptySpanL="0"\n                            emptySpanM="0"\n                            emptySpanS="0"\n                            columnsXL="2"\n                            columnsL="2"\n                            columnsM="1"\n                            singleContainerFullSize="false"><f:content><Label text="GL Account Type"/><Input value="{GLRequestModel>/GLAccountType}"\n                                       editable="{ui>/editable}"/><Label text="Account Group"/><Input value="{GLRequestModel>/AccountGroup}"\n                                       editable="{ui>/editable}"/><Label text="Short Text"/><Input value="{GLRequestModel>/ShortText}"\n                                       editable="{ui>/editable}"/><Label text="Long Text"/><Input value="{GLRequestModel>/GLAccountLongText}"\n                                       editable="{ui>/editable}"/></f:content></f:SimpleForm></IconTabFilter><IconTabFilter text="Control Data" icon="sap-icon://settings"><f:SimpleForm\n                            editable="true"\n                            layout="ResponsiveGridLayout"\n                            labelSpanXL="4"\n                            labelSpanL="3"\n                            labelSpanM="12"\n                            labelSpanS="12"\n                            adjustLabelSpan="false"\n                            emptySpanXL="0"\n                            emptySpanL="0"\n                            emptySpanM="0"\n                            emptySpanS="0"\n                            columnsXL="2"\n                            columnsL="2"\n                            columnsM="1"\n                            singleContainerFullSize="false"><f:content><Label text="Account Currency"/><Input value="{GLRequestModel>/AccountCurrency}"\n                                       editable="{ui>/editable}"/><Label text="Local Currency Only"/><CheckBox selected="{GLRequestModel>/LocalCurrencyOnly}"\n                                          enabled="{ui>/editable}"/><Label text="Open Item Management"/><CheckBox selected="{GLRequestModel>/OpenItemManagement}"\n                                          enabled="{ui>/editable}"/></f:content></f:SimpleForm></IconTabFilter><IconTabFilter text="Create / Bank" icon="sap-icon://money-bills"><f:SimpleForm\n                            editable="true"\n                            layout="ResponsiveGridLayout"\n                            labelSpanXL="4"\n                            labelSpanL="3"\n                            labelSpanM="12"\n                            labelSpanS="12"\n                            adjustLabelSpan="false"\n                            emptySpanXL="0"\n                            emptySpanL="0"\n                            emptySpanM="0"\n                            emptySpanS="0"\n                            columnsXL="2"\n                            columnsL="2"\n                            columnsM="1"\n                            singleContainerFullSize="false"><f:content><Label text="Field Status Group"/><Input value="{GLRequestModel>/FieldStatusGroup}"\n                                       editable="{ui>/editable}"/><Label text="House Bank"/><Input value="{GLRequestModel>/HouseBank}"\n                                       editable="{ui>/editable}"/></f:content></f:SimpleForm></IconTabFilter></items></IconTabBar></content><footer><OverflowToolbar><ToolbarSpacer/><Button text="{ui>/closeText}" press="onCloseGL"/></OverflowToolbar></footer></Dialog></core:FragmentDefinition>\n',
	"approvals/i18n/i18n.properties":'# This is the resource bundle for approvals\n\n#Texts for manifest.json\n\n#XTIT: Application name\nappTitle=approvals\n\n#YDES: Application description\nappDescription=An SAP Fiori application.\n#XTIT: Main view title\ntitle=approvals\n\n#XFLD,27\napprovals-approvals.flpTitle=approvals\n',
	"approvals/manifest.json":'{"_version":"1.76.0","sap.app":{"id":"approvals","type":"application","i18n":{"bundleUrl":"i18n/i18n.properties","supportedLocales":[""]},"applicationVersion":{"version":"0.0.1"},"title":"{{appTitle}}","description":"{{appDescription}}","resources":"resources.json","sourceTemplate":{"id":"@sap/generator-fiori:basic","version":"1.20.0","toolsId":"d049ab33-4d55-4cb6-aeb9-1f237f36574e"},"dataSources":{"mainService":{"uri":"/odata/v2/zmdggl-master/","type":"OData","settings":{"annotations":[],"odataVersion":"2.0"}},"CreateGLService":{"uri":"/sap/opu/odata/sap/ZGLACCT_DETAILS_SRV/","type":"OData","settings":{"odataVersion":"2.0"}}},"crossNavigation":{"inbounds":{"approvals-approvals":{"semanticObject":"approvals","action":"approvals","title":"{{approvals-approvals.flpTitle}}","signature":{"parameters":{},"additionalParameters":"allowed"}}}}},"sap.ui":{"technology":"UI5","icons":{"icon":"","favIcon":"","phone":"","phone@2":"","tablet":"","tablet@2":""},"deviceTypes":{"desktop":true,"tablet":true,"phone":true}},"sap.ui5":{"flexEnabled":true,"dependencies":{"minUI5Version":"1.143.2","libs":{"sap.m":{},"sap.ui.core":{}}},"contentDensities":{"compact":true,"cozy":true},"models":{"i18n":{"type":"sap.ui.model.resource.ResourceModel","settings":{"bundleName":"approvals.i18n.i18n","supportedLocales":[""]}},"mainServiceModel":{"dataSource":"mainService","preload":true,"settings":{"operationMode":"Server","autoExpandSelect":true,"earlyRequests":true}},"CreateGLServiceModel":{"dataSource":"CreateGLService","preload":true,"settings":{"useBatch":false,"defaultBindingMode":"TwoWay"}}},"resources":{"css":[{"uri":"css/style.css"}]},"routing":{"config":{"routerClass":"sap.m.routing.Router","controlAggregation":"pages","controlId":"app","transition":"slide","type":"View","viewType":"XML","path":"approvals.view","async":true,"viewPath":"approvals.view"},"routes":[{"name":"Routeapprovals","pattern":":?query:","target":["Targetapprovals"]}],"targets":{"Targetapprovals":{"id":"approvals","name":"approvals"}}},"rootView":{"viewName":"approvals.view.approvals","type":"XML","id":"app","async":true},"flexBundle":false},"sap.cloud":{"public":true,"service":"MDG_GL_MASTER"},"sap.bpa.task":{"_version":"1.1.0","outcomes":[{"id":"approve","label":"Approve","type":"positive"},{"id":"reject","label":"Reject","type":"negative"},{"id":"rework","label":"Re-Work","type":"neutral"}],"inputs":{"$schema":"http://json-schema.org/draft-07/schema","title":"input","type":"object","required":[]},"outputs":{"$schema":"http://json-schema.org/draft-07/schema","title":"output","type":"object","required":[],"properties":{"Comments":{"type":"array","items":{"type":"object"},"default":[],"title":"comment","description":"Approver\'s Response"},"ApproverId":{"type":"string","title":"approverid","description":"Approver\'s ID"},"Approve":{"type":"string","title":"Approve","description":"Approve"},"Reject":{"type":"string","title":"Reject","description":"Reject"}},"TaskInfo":{"type":"object","description":"Task Instance details","properties":{"ID":{"type":"string","description":"Task Instance id","title":"Task Instance ID"},"Approver":{"type":"string","description":"Approver completed the task","title":"Approver"},"Decision":{"type":"string","description":"Approver Decision","title":"Decision"}}}},"category":"approval"}}',
	"approvals/view/App.view.xml":'<mvc:View controllerName="approvals.controller.App"\n    displayBlock="true"\n    xmlns:mvc="sap.ui.core.mvc"\n    xmlns="sap.m"><App id="app"></App></mvc:View>',
	"approvals/view/approvals.view.xml":'<mvc:View\n    controllerName="approvals.controller.approvals"\n    xmlns:mvc="sap.ui.core.mvc"\n    xmlns="sap.m"\n    xmlns:l="sap.ui.layout"><App id="app"><pages><Page id="page" title="{i18n>title}"><content><l:HorizontalLayout id="layout1" /><Panel\n                        headerText="GL Master Items"\n                        expandable="true"\n                        expanded="true"\n                        width="auto"\n                        class="sapUiResponsiveMargin"><Table\n                            id="tablelist"\n                            inset="false"\n                            noDataText="No GL records available"\n                            selectionChange=".onSelectionChange"\n                            mode="SingleSelectLeft"\n                            items="{glModel>/items}"><headerToolbar><OverflowToolbar><content><ToolbarSpacer /><Button\n                                            id="changeLogBtn"\n                                            text="Change Log"\n                                            icon="sap-icon://notes"\n                                            enabled="false"\n                                            press="onChangeLogPressed" /><Button\n                                            id="viewbtn"\n                                            text="View"\n                                            type="Emphasized"\n                                            icon="sap-icon://detail-view"\n                                            enabled="false"\n                                            press="onViewApproval" /><Button\n                                            id="editbtn"\n                                            text="Edit"\n                                            type="Emphasized"\n                                            icon="sap-icon://edit"\n                                            enabled="false"\n                                            visible="false"\n                                            press="onEditGL" /></content></OverflowToolbar></headerToolbar><columns><Column><Text text="GL Account" /></Column><Column><Text text="Company Code" /></Column><Column><Text text="GL Type" /></Column><Column><Text text="Account Group" /></Column></columns><items><ColumnListItem><cells><Text text="{glModel>GLAccount}" /><Text text="{glModel>CompanyCode}" /><Text text="{glModel>GLAccountType}" /><Text text="{glModel>AccountGroup}" /></cells></ColumnListItem></items></Table></Panel><Panel\n                        id="idComments"\n                        expanded="true"\n                        expandable="true"\n                        headerText="Comments"\n                        width="auto"\n                        class="sapUiResponsiveMargin"><content><FeedInput\n                                id="fIC"\n                                post=".onCommentPost"\n                                maxLength="100"\n                                placeholder="Add a comment (max 100 characters)"\n                                icon="sap-icon://comment" /><List\n                                id="flist"\n                                showSeparators="Inner"\n                                items="{commentModel>/}"><FeedListItem\n                                    sender="{commentModel>UserName}"\n                                    timestamp="{commentModel>Date}"\n                                    text="{commentModel>Text}" /></List></content></Panel></content></Page></pages></App></mvc:View>\n'
});
//# sourceMappingURL=Component-preload.js.map
